---
title: "Final Exam"
output: html_notebook
---

Install necessary packages

```{r}
  if (!require(rpart.plot)) install.packages("rpart.plot", dependencies=TRUE)
  if (!require(caret)) install.packages("caret", dependencies=TRUE)
  if (!require(tidyverse)) install.packages("tidyverse", dependencies=TRUE)
  
  library(caret)
  library(ggplot2)
  library(stringr)
  library(tidyverse)
  library(rpart)
  library(rpart.plot)
  library(e1071)


```


Read data and start preprocessing
```{r}
# Read the dataset
data <- read.csv("ckd-dataset.csv")

# Display the first few rows of the dataset
head(data)

# Remove rows with missing values
data <- na.omit(data)

# Convert all features to factors
data <- data %>% mutate(across(everything(), as.factor))

# Ensure the target variable 'class' is a factor
if (!is.factor(data$class)) {
  data$class <- as.factor(data$class)
}

# Remove rare classes
rare_classes <- names(which(table(data$class) < 2))
data <- data[!data$class %in% rare_classes, ]

# Verify the structure of the dataset
str(data)


```



```{r}

    
  
 set.seed(123)
 trainIndex <- createDataPartition(data$class, p = .8, 
                                  list = FALSE, 
                                  times = 1)
 dataTrain <- data[ trainIndex,]
 dataTest  <- data[-trainIndex,]

```


```{r}

model <- rpart(class ~ ., data = dataTrain, method = "class")

# Plot the decision tree
rpart.plot(model)


```


```{r}

predictions <- predict(model, dataTest, type = "class")

# Confusion matrix
confusionMatrix(predictions, dataTest$class)



```



```{r}


# Calculate accuracy
accuracy <- sum(predictions == dataTest$class) / nrow(dataTest)
print(paste("Accuracy:", round(accuracy, 4)))

# Print confusion matrix
confMat <- confusionMatrix(predictions, dataTest$class)
print(confMat)



```



```{r}


## Discussion and Interpretation

In dieser Studie haben wir ein Entscheidungsbaum-Modell entwickelt, um das Risiko einer chronischen Nierenerkrankung anhand der vorgegebenen Merkmale vorherzusagen. Alle Merkmale wurden als kategoriale Variablen behandelt, um dem Feedback des Professors zu entsprechen.

### Modellergebnisse
Die Genauigkeit des Modells beträgt `r round(accuracy, 4)`. Die Verwirrungsmatrix zeigt die Leistung des Modells bei der Vorhersage der Zielvariable auf dem Testdatensatz.

### Interpretation
Das Entscheidungsbaum-Modell bietet eine visuell interpretierbare Methode zur Identifizierung von Risikofaktoren für chronische Nierenerkrankungen. Jede Verzweigung im Baum repräsentiert eine Entscheidung auf Basis eines Merkmalswerts, was es einfach macht, die Entscheidungswege nachzuvollziehen.

### Schlussfolgerungen
Dieses Modell kann nützlich sein, um potenzielle Risikopatienten zu identifizieren und präventive Maßnahmen zu ergreifen. Weitere Schritte könnten die Validierung des Modells auf größeren und vielfältigeren Datensätzen sowie die Untersuchung anderer Modellierungstechniken umfassen.



```



