---
title: "Final Exam"
output: html_notebook
---

Install necessary packages

```{r}
  if (!require(rpart.plot)) install.packages("rpart.plot", dependencies=TRUE)
  if (!require(caret)) install.packages("caret", dependencies=TRUE)
  if (!require(tidyverse)) install.packages("tidyverse", dependencies=TRUE)
  
  library(caret)
  library(ggplot2)
  library(stringr)
  library(tidyverse)
  library(rpart)
  library(rpart.plot)
  library(e1071)


```


Read data and start preprocessing
```{r}
# Read the dataset
data <- read.csv("ckd-dataset.csv")

# Display the first few rows of the dataset
head(data)

# Remove rows with missing values
data <- na.omit(data)

# Convert all features to factors
data <- data %>% mutate(across(everything(), as.factor))

# Remove empty and rare classes
## Was mach der Befehl?: data <- data[!data$class %in% c("", "discrete"), ]

# Verify the structure of the dataset
str(data)
summary(data)
table(data$class)

```



```{r}
#Split the data into training and testing sets
    
set.seed(123)
trainIndex <- createDataPartition(data$class, p = .8, list = FALSE, times = 1)

dataTrain <- data[trainIndex, ]
dataTest <- data[-trainIndex, ]

```


```{r}

model <- rpart(class ~ ., data = dataTrain, method = "class")

# Plot the decision tree
rpart.plot(model)


```


```{r}

predictions <- predict(model, dataTest, type = "class")
predictions <- droplevels(predictions)
dataTest$class <- factor(dataTest$class, levels = c("ckd", "notckd"))
levels(dataTest$class)



# Confusion matrix
confMatrix <- confusionMatrix(predictions, dataTest$class)
print(confMatrix)


```

```{r}


# Calculate accuracy
accuracy <- sum(predictions == dataTest$class) / nrow(dataTest)
print(paste("Accuracy:", round(accuracy, 4)))




```
